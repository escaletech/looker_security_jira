with 

source as (

    select * from {{ source('trusted_homeservices_general', 'hubchat_chat_messages_context') }}

),

renamed as (

    select
        _id,
        acquisition_campaign,
        acquisition_domain,
        acquisition_midia,
        acquisition_page,
        acquisition_source,
        address_city,
        address_complement,
        address_neighborhood,
        address_number,
        address_state,
        address_street,
        address_validate,
        address_zip_code,
        amount_recoveries,
        bank,
        bank_account,
        bank_agency,
        bank_confirmation,
        birth_date,
        combination,
        customer,
        data_validate,
        ddd,
        element_name_hsm,
        email,
        finish_checkout,
        finish_product,
        finish_qualification,
        finish_viability,
        history_hsm,
        individual_registration,
        lake_created_at,
        lead_id,
        mother_name,
        name,
        national_identity,
        numero_telefone,
        operation_brand,
        operation_product,
        operation_vertical,
        opt_out,
        order,
        order_date_time,
        order_id,
        payment_due_date,
        payment_type,
        payment_type_description,
        phone_number,
        product_description,
        product_validate,
        qualification,
        reason_welcome_customer,
        recover,
        second_phone_number,
        select_product,
        select_product_image,
        send_hsm,
        session,
        show_cron,
        show_cron_opt_out,
        show_date_one,
        show_date_two,
        show_period_one,
        show_period_two,
        show_product,
        show_product_image,
        start_checkout,
        start_product,
        start_qualification,
        start_viability,
        template_name_whatsapp,
        test_ab,
        timestamp,
        timestamp_init,
        token,
        transfer_department,
        transfer_human,
        type_contact,
        type_line_description,
        type_product,
        type_product_description,
        type_viability,
        update_version_date_time,
        version,
        viability_product,
        viability_product_description,
        welcome,
        welcome_customer,
        whatsapp_phone_number,
        whatsapp_phone_number_id,
        year,
        month,
        day,
        lake_key,
        cidade,
        uf,
        address_validate_customer,
        city_customer,
        complement_customer,
        finish_viability_customer,
        neighborhood_customer,
        number_customer,
        reason_change_data_product_customer,
        reason_change_data_reason_address_customer,
        select_change_data_address_customer,
        select_change_data_customer,
        select_change_data_product_customer,
        select_change_data_reason_address_customer,
        start_viability_customer,
        state_customer,
        street_customer,
        viability_customer,
        zip_code_customer,
        fluxo_ab,
        show_cron_click_to_call,
        show_cron_type10,
        show_cron_type20,
        show_cron_type30,
        show_cron_type40,
        show_cron_type60,
        period_customer,
        reason_change_data_period_customer,
        select_change_data_reason_period_customer,
        select_not_order_customer,
        select_period_customer,
        select_doubts_customer,
        select_other_doubts_customer,
        company_name,
        company_registration,
        customer_type,
        elegibility_distributor,
        eligibility_consumption,
        finish_eligibility,
        select_welcome,
        send_photo,
        start_eligibility,
        distributor_name,
        select_qualification,
        show_cron_type15,
        show_cron_type35,
        show_cron_type6,
        select_cancel_order_customer,
        return_api_combination,
        return_api_complement,
        return_api_individual_registration,
        return_api_order,
        return_api_portability,
        return_api_product,
        return_api_schedule,
        return_api_viability,
        return_api_zip_code,
        timeout_catalog10,
        timeout_catalog20,
        timeout_catalog30,
        timeout_catalog40,
        timeout_catalog60,
        timeout_checkout_finalize10,
        timeout_checkout_finalize20,
        timeout_checkout_finalize30,
        timeout_checkout_finalize40,
        timeout_checkout_finalize60,
        timeout_checkout_payment10,
        timeout_checkout_payment20,
        timeout_checkout_payment30,
        timeout_checkout_payment40,
        timeout_checkout_payment60,
        timeout_checkout_personal_data10,
        timeout_checkout_personal_data20,
        timeout_checkout_personal_data30,
        timeout_checkout_personal_data40,
        timeout_checkout_personal_data60,
        timeout_qualification10,
        timeout_qualification20,
        timeout_qualification30,
        timeout_viability10,
        timeout_viability20,
        timeout_viability30,
        simulation,
        select_track_order_customer,
        chance_data_customer,
        doubts_customer,
        other_doubts_customer,
        select_chance_data_customer,
        not_order_customer,
        cancel_order_customer,
        track_order_customer,
        reason_change_data_address_customer,
        reason_change_customer,
        select_chance_data_address_customer,
        select_reason_customer,
        amount_not_understand,
        amount_returns,
        not_understand,
        return,
        card_confirmation,
        know_product,
        send_data,
        show_cron_type120,
        show_cron_type20h,
        show_cron_type90,
        terms_conditions

    from source

)

select 
    session message_session_id
    ,timestamp
    ,regexp_replace(numero_telefone, '[^0-9]', '') AS client_id
    ,token
    ,welcome
    ,customer
    ,start_viability
    ,start_checkout
    ,qualification
    ,finish_viability
    ,finish_checkout
    ,show_product
    ,viability_product
    ,address_validate
    ,order
    ,type_product
    ,select_product
    ,product_description
    ,viability_product_description
from renamed
